CHGDATE
=======

MS-DOSのシステム日時の取得や変更を行うファンクションコールは、日付（年月日）と時間（時分秒）で別になっており、日時を同時に取得・設定したい場合はファンクションコールを２度呼び出す必要がある。
このため、日付の変更されるタイミング（23:59:59→00:00:00）で日時の取得や設定を行ったとき、得られる結果が想定と異なる場合がある。

…という状況を確認するためのテストプログラムです。
本プログラムは無保証です。各自の責任においてご利用ください。


用法
----

chgdate.cを適当な16ビットDOS用Cコンパイラでコンパイルし、MS-DOSのDOSプロンプト上でchgdate.exeを実行します。
テストプログラムはMS-DOSのCLOCKデバイスに対する「可能な限りの全力」での呼び出しを試みます。環境によっては、内蔵の時計ICに対して想定外なレベルでの過酷なアクセスを行う可能性がありますのでご注意ください（※PC-98系環境での実行は、正直おすすめできません）。

    chgdate [-P テスト回数] [-S]

オプションなしでchgdateを起動した場合は、日付が変わるまで現在時刻を表示し続けます。Escキーを押すと終了します。

日付変更テストを行う場合は -P オプションを（テスト回数の数字つきで）設定します。
このテストはシステム時刻を23:59:58に設定します。ユーザー設定のシステム日時を使えないDOS環境（エミュレータ系など）で実行した場合、おそろしく時間がかかります。

オプション -S を指定すると、日付ずれの可能性を排除した（おそらくは安全だと思われる）日時の取得法を使います。「日付→時刻の順で取得し、00:00:00だったときは（途中で日付が進んだ可能性があるので）もう一度日付を取得する」という手順になっています。
とりあえず chgdate -S -P100 で100回ほどテストした限りでは日付のずれは確認されませんでした（-Sなしの場合、手元の環境では50%ほどの確率でずれが発生）。

なお、テスト終了時にシステム日時は戻さないので、その後もDOS環境で別の作業を行う場合は手動で日付(date)と時刻(time)の再設定を行ってください。


